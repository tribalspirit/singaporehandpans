# üß™ Handpan Widget ‚Äì Interaction & Highlighting Test MatrixThis document defines the **authoritative behavioral contract** for the Handpan Memorization widget.Any implementation that does not satisfy **ALL** tests below is considered **incorrect**, even if it ‚Äúlooks fine‚Äù.---## üîë Definitions### PadA visual note on the handpan layout (e.g. `D4`, `A4`, `D5`).### Scale NoteA note badge in the **Scale Notes** section (exact note string).### Pitch Class (PC)Note name without octave (e.g. `D`, `F`, `A`).---## üß† Playback State Model (Baseline)| Field | Meaning ||----|----|| `activePadNote` | EXACT note (with octave). Single-note interactions only || `activePitchClasses` | Array of pitch classes. Chord interactions only || `isPlaying` | Transport state |### Invariant Rules- `activePadNote !== null` ‚áí `activePitchClasses === null`- `activePitchClasses !== null` ‚áí `activePadNote === null`- **Never highlight by pitch class during single-note interaction**---# 1Ô∏è‚É£ Handpan Pad Clicks### Test 1.1 ‚Äî Basic pad click (single octave)**Action**- Click pad `D4`**Expected**- `activePadNote = "D4"`- `activePitchClasses = null`- Highlighted pads: `["D4"]`- Highlighted scale notes: `["D4"]`- ‚ùå `D5` NOT highlighted---### Test 1.2 ‚Äî Pad click with multiple octave pads present**Setup**- Layout contains `D4` and `D5`**Action**- Click `D5`**Expected**- Highlighted pads: `["D5"]`- Highlighted scale notes: `["D5"]`- ‚ùå `D4` NOT highlighted---# 2Ô∏è‚É£ Scale Note Clicks### Test 2.1 ‚Äî Scale note exists as pad**Action**- Click scale note `A4`**Expected**- `activePadNote = "A4"`- Highlighted pads: `["A4"]`- Highlighted scale notes: `["A4"]`---### Test 2.2 ‚Äî Scale note does NOT exist as pad**Setup**- Scale note list contains `D4`- Layout contains only `D5`**Action**- Click scale note `D4`**Expected**- `activePadNote = "D4"`- Highlighted pads: `["D5"]` (mapped best pad)- Highlighted scale notes: `["D4"]`- ‚ùå No multi-pad highlight---# 3Ô∏è‚É£ Scale Playback (Play Button)### Test 3.1 ‚Äî Sequential playback highlights exact notes**Action**- Click **Play** in Scale Info**For each step**- `activePadNote = step.note`- `activePitchClasses = null`**Expected**- Exactly **ONE** pad highlighted per step- Exactly **ONE** scale note highlighted per step- Pads and scale notes move in sync---### Test 3.2 ‚Äî Playback reset**Action**- Playback completes**Expected**- `activePadNote = null`- `activePitchClasses = null`- No pads highlighted- No scale notes highlighted---# 4Ô∏è‚É£ Chord Selection (NO playback)### Test 4.1 ‚Äî Basic triad selection**Action**- Select chord **Dm****Expected**- `activePadNote = null`- `activePitchClasses = ["D", "F", "A"]`- Highlighted pads:  - ALL `D*`, `F*`, `A*` pads (all octaves)- Highlighted scale notes:  - All notes with pitch classes D, F, A---### Test 4.2 ‚Äî Chord deselection**Action**- Click selected chord again**Expected**- `activePadNote = null`- `activePitchClasses = null`- No highlights anywhere---# 5Ô∏è‚É£ Chord Playback ‚Äî Simultaneous### Test 5.1 ‚Äî Simultaneous chord play**Action**- Select chord ‚Üí Click **Play (Simultaneous)****Expected**- During playback:  - `activePitchClasses = chord.pitchClasses`  - All chord pads highlighted- After playback:  - All highlights cleared---# 6Ô∏è‚É£ Chord Playback ‚Äî Arpeggio### Test 6.1 ‚Äî Arpeggio highlights pitch classes**Action**- Select chord ‚Üí Play arpeggio**On each step**- `activePadNote = null`- `activePitchClasses = [currentPitchClass]`**Expected**- All pads matching current pitch class highlighted- Scale notes matching pitch class highlighted- ‚ùå No octave-specific highlighting---# 7Ô∏è‚É£ Interaction Priority Rules### Test 7.1 ‚Äî Manual click overrides chord highlight**Setup**- Chord selected (pads highlighted)**Action**- Click pad `A4`**Expected**- Chord highlight CLEARED- `activePadNote = "A4"`- Only `A4` highlighted---### Test 7.2 ‚Äî Scale click overrides chord highlight**Setup**- Chord selected**Action**- Click scale note `F5`**Expected**- Chord highlight CLEARED- Only mapped pad for `F5` highlighted---# 8Ô∏è‚É£ Regression Guards (CRITICAL)### ‚ùå Forbidden behaviors (tests must FAIL if these occur)- Clicking `D4` highlights `D5`- Scale playback highlights multiple pads at once- Pitch-class logic used when `activePadNote` is set- Exact-note logic used when `activePitchClasses` is set- Highlight logic duplicated across components---## ‚úÖ Definition of DoneAll tests above pass for:- Every handpan type- Every scale- Every chord category- Multiple octave layoutsIf even **one** test fails, the implementation is **not correct**.---## üîí Contract StatementThis matrix is the **single source of truth**.No refactor, optimization, or ‚Äúimprovement‚Äù may violate it.

