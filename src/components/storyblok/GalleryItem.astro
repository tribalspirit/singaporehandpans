---
import { storyblokEditable } from '@storyblok/astro';

export interface Props {
  blok: {
    title: string;
    description?: string;
    image?: {
      filename: string;
      alt?: string;
    };
    tags?: string | string[];
    featured?: boolean;
    alt_text?: string;
    sort_order?: number;
  };
}

const { blok } = Astro.props;

// Normalize tags to always be an array (handles string from Storyblok or array)
const normalizeTags = (tags: string | string[] | undefined): string[] => {
  if (!tags) return [];
  if (Array.isArray(tags)) return tags;
  if (typeof tags === 'string') return tags.split(',').map(t => t.trim()).filter(Boolean);
  return [];
};

const itemTags = normalizeTags(blok.tags);
---

<div class="storyblok-gallery-item" {...storyblokEditable(blok)}>
  {blok.image && (
    <div class="gallery-item-image">
      <img 
        src={blok.image.filename} 
        alt={blok.alt_text || blok.image.alt || blok.title}
        loading="lazy"
      />
    </div>
  )}
  
  <div class="gallery-item-content">
    <h3 class="gallery-item-title">{blok.title}</h3>
    
    {blok.description && (
      <p class="gallery-item-description">{blok.description}</p>
    )}
    
    {itemTags.length > 0 && (
      <div class="gallery-item-tags">
        {itemTags.map(tag => (
          <span class="tag">{tag}</span>
        ))}
      </div>
    )}
  </div>
</div>

<style lang="scss">
@import "src/styles/tokens.scss";

.storyblok-gallery-item {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  overflow: hidden;
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
}

.gallery-item-image {
  position: relative;
  height: 200px;
  overflow: hidden;

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  &:hover img {
    transform: scale(1.05);
  }
}

.gallery-item-content {
  padding: var(--spacing-md);
}

.gallery-item-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
  margin-bottom: var(--spacing-sm);
}

.gallery-item-description {
  color: var(--color-text-secondary);
  line-height: 1.6;
  margin-bottom: var(--spacing-sm);
}

.gallery-item-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);

  .tag {
    background: var(--color-accent-light);
    color: var(--color-accent-dark);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    text-transform: capitalize;
  }
}
</style>

